var glitcher=require("glitcher"),fs=require("fs"),gifwriter=require("./../node_modules/glitcher/node_modules/writegif"),readimage=require("./../node_modules/glitcher/node_modules/readimage"),shared={},randInvert=function(e,r){var a=100*Math.random();r>a&&glitcher.invertRGBA(e)},randReverse=function(e,r){var a=100*Math.random();r>a&&glitcher.reverseRGBA(e)},randSwapChannels=function(e,r){var a=100*Math.random();r>a&&glitcher.swapChannels(e)},randRBOverlay=function(e,r){var a=100*Math.random();r>a&&glitcher.redBlueOverlay(e)},randClampColors=function(e,r,a,n){var i=100*Math.random();r>i&&glitcher.clampColors(e,a,n)};shared.jpgToGif=function(e,r,a){readimage(e,function(e,n){if(e)return a(e);if(1===n.frames.length)for(var i=glitcher.copy(n.frames[0].data),t=0;30>t;t++)n.addFrame(glitcher.copy(i),100);return n.frames.forEach(function(e){r.forEach(function(r){switch(r.alias){case"invert":randInvert(e.data,r.options.frequency.value);break;case"reverse":randReverse(e.data,r.options.frequency.value);break;case"swapChannels":randSwapChannels(e.data,r.options.frequency.value);break;case"redBlueOverlay":randRBOverlay(e.data,r.options.frequency.value);break;case"clampColors":randClampColors(e.data,r.options.frequency.value,r.options.max.value,r.options.tolerance.value)}})}),a(null,n)})},shared.glitchImage=function(e,r){require("purdy")(r),shared.jpgToGif(fs.readFileSync(e),r,function(r,a){gifwriter(a,function(r,a){fs.writeFileSync(e.replace("jpeg","gif"),a)})})},module.exports.glitchImage=shared.glitchImage;