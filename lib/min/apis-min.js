var Fs=require("fs"),Hoek=require("hoek"),Nes=require("nes"),Fs=require("fs"),Url=require("url"),Sandglitch=require("../lib/sandglitch");exports.register=function(e,r,i){e.route({method:"GET",path:"/local/{jsonFile*}",handler:function(e,r){var i=[__dirname,"..","fixtures",encodeURIComponent(e.params.jsonFile)].join("/");r.file(i)}}),e.route({method:"POST",path:"/sand",config:{payload:{output:"stream",parse:!0,allow:"multipart/form-data"},handler:function(e,r){var i=e.payload;require("purdy")(e.payload);var a=i.image,o=i.effects,t="./assets/temp/temp.jpg",n=Fs.createWriteStream(t);n.on("pipe",function(e){require("purdy")(e)}),n.on("error",function(e){console.error(e)}),require("purdy")(i),i.image.pipe(n),n.on("finish",function(e){require("purdy")(n),console.log('file.on("finish"): '+n);var i=Sandglitch.glitchImage(n.path,JSON.parse(o));r(n.path.replace("jpeg","gif"))})}}}),i()},exports.register.attributes={name:"apis-routes",version:"1.0.0"};